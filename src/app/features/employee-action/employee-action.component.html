<div class="backdrop" (click)="close.emit()"></div>
<div class="sheet card">
  <header>
    <div>
      <div class="label">Action</div>
      <div class="title">{{ employee.employee_name || employee.name }}</div>
      <div class="meta">ID: {{ employee.name }}</div>
    </div>
    <button class="btn outline" (click)="close.emit()">Close</button>
  </header>

  <section class="capture">
    <label class="file-label">
      <input #fileInput type="file" accept="image/*" capture="environment" (change)="onFileChange($event)">
      <span>ðŸ“¸ Capture / upload photo (required)</span>
    </label>
    <div class="preview" *ngIf="photoPreview">
      <img [src]="photoPreview" alt="Preview">
    </div>

    <!-- Camera overlay used when the supervisor clicks Check IN/OUT and we need to capture a photo -->
    <div class="camera-overlay" *ngIf="capturing">
      <video #video autoplay playsinline></video>
      <div class="camera-controls">
        <button class="btn primary" (click)="takePhotoAndSubmit()">Take Photo</button>
        <button class="btn outline" (click)="cancelCapture()">Cancel</button>
      </div>
    </div>
  </section>

  <section class="location">
    <div class="row">
      <div>
        <div class="label">Location</div>
        <div *ngIf="location?.status === 'ok'">
          Lat: {{ location?.lat }}, Lng: {{ location?.lng }} (Â±{{ location?.accuracy }}m)
        </div>
        <div *ngIf="location?.status === 'denied'">User denied GPS. Will submit with status=denied.</div>
        <div *ngIf="capturingLocation">Fetching locationâ€¦</div>
        <div *ngIf="!location && !capturingLocation">Not captured yet.</div>
      </div>
      <button class="btn outline" type="button" (click)="captureLocation()">Get GPS</button>
    </div>
  </section>

  <section class="actions">
    <button class="btn primary" [disabled]="loading" (click)="submit('IN')">Check IN</button>
    <button class="btn outline" [disabled]="loading" (click)="submit('OUT')">Check OUT</button>
  </section>

  <div class="alert danger" *ngIf="error">{{ error }}</div>
  <div class="alert success" *ngIf="successMessage">{{ successMessage }}</div>
  <div class="note">
    Files are attached privately to Employee Checkin. Location status is stored even if GPS denied/unavailable.
  </div>
</div>
